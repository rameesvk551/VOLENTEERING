# ğŸ—ºï¸ Route Optimization - Visual Architecture

## ğŸ“± User Interface Flow

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                    DISCOVERY PAGE                              â•‘
â•‘                                                                â•‘
â•‘  [Search: Singapore attractions]  [Filters â–¼]                 â•‘
â•‘                                                                â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â•‘
â•‘  â”‚ Marina Bay     â”‚  â”‚ Gardens by Bay  â”‚  â”‚ Merlion     â”‚  â•‘
â•‘  â”‚ [Image]         â”‚  â”‚ [Image]         â”‚  â”‚ [Image]     â”‚  â•‘
â•‘  â”‚ â˜ Select        â”‚  â”‚ â˜‘ Selected      â”‚  â”‚ â˜‘ Selected  â”‚  â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â•‘
â•‘                                                                â•‘
â•‘                                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â•‘
â•‘                                            â”‚   FAB         â”‚  â•‘
â•‘                                            â”‚   ğŸ—ºï¸  2      â”‚  â•‘
â•‘                                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                             â”‚
                             â”‚ User clicks FAB
                             â–¼
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘              OPTIMIZE MODAL (Bottom Sheet)                     â•‘
â•‘                                                                â•‘
â•‘  Plan trip for 2 stops                                    [X] â•‘
â•‘  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â•‘
â•‘                                                                â•‘
â•‘  Travel Types                                                  â•‘
â•‘  [â˜‘ Public Transport]  [â˜‘ Walking]  [â˜ Driving]               â•‘
â•‘  [â˜ Cycling]          [â˜ E-Scooter]                           â•‘
â•‘                                                                â•‘
â•‘  Budget (optional)                                             â•‘
â•‘  [50] SGD                                                      â•‘
â•‘                                                                â•‘
â•‘  Options                                                       â•‘
â•‘  [â˜‘] Include real-time transit data                           â•‘
â•‘                                                                â•‘
â•‘  [Optimize Route â¤]                                           â•‘
â•‘                                                                â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                             â”‚
                             â”‚ User clicks Optimize
                             â–¼
```

---

## ğŸŒ Network Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        FRONTEND                                  â”‚
â”‚                     (localhost:5173)                             â”‚
â”‚                                                                  â”‚
â”‚  VirtualizedAttractionFeed.tsx                                   â”‚
â”‚         â”‚                                                        â”‚
â”‚         â”œâ”€ useState(selectedAttractions)                        â”‚
â”‚         â”œâ”€ handleOptimizeSubmit()                               â”‚
â”‚         â””â”€ useOptimizeRouteMutation()                           â”‚
â”‚                   â”‚                                              â”‚
â”‚                   â”œâ”€ routeOptimizer.api.ts                      â”‚
â”‚                   â”‚    â””â”€ axios.post()                          â”‚
â”‚                   â”‚                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â”‚ POST /api/v1/optimize-route
                    â”‚ Content-Type: application/json
                    â”‚ {places, constraints, options}
                    â”‚
                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      API GATEWAY                                 â”‚
â”‚                    (localhost:4000)                              â”‚
â”‚                                                                  â”‚
â”‚  index.ts                                                        â”‚
â”‚    â”œâ”€ CORS middleware                                            â”‚
â”‚    â”œâ”€ Rate limiting                                              â”‚
â”‚    â”œâ”€ Optional auth                                              â”‚
â”‚    â””â”€ Proxy to Route Optimizer                                  â”‚
â”‚                   â”‚                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â”‚ HTTP Proxy Forward
                    â”‚ timeout: 60s
                    â”‚
                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  ROUTE OPTIMIZER SERVICE                         â”‚
â”‚                    (localhost:4010)                              â”‚
â”‚                                                                  â”‚
â”‚  index.ts                                                        â”‚
â”‚    â””â”€ POST /api/optimize-route                                  â”‚
â”‚              â”‚                                                   â”‚
â”‚              â”œâ”€ optimize-route.handler.ts                       â”‚
â”‚              â”‚    â”œâ”€ Zod validation                             â”‚
â”‚              â”‚    â”œâ”€ Error handling                             â”‚
â”‚              â”‚    â””â”€ Call service                               â”‚
â”‚              â”‚              â”‚                                    â”‚
â”‚              â””â”€ route-optimizer-v2.service.ts                   â”‚
â”‚                             â”‚                                    â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚                    â”‚                 â”‚                          â”‚
â”‚         buildDistanceMatrix()   runTSP()                        â”‚
â”‚                    â”‚                 â”‚                          â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”                   â”‚
â”‚              â”‚           â”‚    â”‚           â”‚                    â”‚
â”‚         OSRM API    Haversine  NearestNeighbor  2-opt          â”‚
â”‚              â”‚           â”‚    â”‚           â”‚                    â”‚
â”‚              â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚                    â”‚                 â”‚                          â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚                             â”‚                                    â”‚
â”‚                    applyConstraints()                           â”‚
â”‚                             â”‚                                    â”‚
â”‚                             â–¼                                    â”‚
â”‚                    Return optimized order                       â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â”‚ Response: {jobId, optimizedOrder, ...}
                    â”‚
                    â–¼
               [Frontend receives & displays]
```

---

## ğŸ§® Algorithm Visualization

### Distance Matrix Computation

```
Places:     A (Marina Bay)    B (Gardens)    C (Merlion)

Distance Matrix (meters):
     A     B     C
A    0   1200  2400
B  1200    0   1800
C  2400  1800    0

Duration Matrix (seconds):
     A    B    C
A    0   240  480
B  240    0  360
C  480  360    0
```

### TSP Optimization Process

**Step 1: Nearest Neighbor (Initial Route)**

```
Start: A
â”‚
â”œâ”€ Find nearest: B (1200m)
â”‚
â”œâ”€ Find nearest: C (1800m from B)
â”‚
Result: A â†’ B â†’ C
Total: 1200 + 1800 = 3000m
```

**Step 2: 2-opt Improvement**

```
Current: A â†’ B â†’ C (3000m)

Try swapping B and C:
Test: A â†’ C â†’ B
Cost: 2400 + 1800 = 4200m âŒ (worse)

Try reversing [B, C]:
Test: A â†’ C â†’ B (same as above) âŒ

No improvement found.
Final: A â†’ B â†’ C (3000m) âœ…
```

### Constraint Application

```
Route: A â†’ B â†’ C
Times: 0  + 240s + 360s = 600s (10 min travel)
Visits:    90min + 120min + 30min = 240min

Total: 250 minutes

Time Budget: 480 minutes âœ… FITS
Result: Keep all 3 places
```

---

## ğŸ“¦ Data Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    REQUEST PAYLOAD                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ {                                                             â”‚
â”‚   "userId": "user-123",                                       â”‚
â”‚   "places": [                                                 â”‚
â”‚     {                                                         â”‚
â”‚       "id": "p1",                                             â”‚
â”‚       "name": "Marina Bay Sands",                             â”‚
â”‚       "lat": 1.2838,                                          â”‚
â”‚       "lng": 103.8607,                                        â”‚
â”‚       "priority": 8,                                          â”‚
â”‚       "visitDuration": 90                                     â”‚
â”‚     },                                                        â”‚
â”‚     { "id": "p2", ... },                                      â”‚
â”‚     { "id": "p3", ... }                                       â”‚
â”‚   ],                                                          â”‚
â”‚   "constraints": {                                            â”‚
â”‚     "startLocation": { "lat": 1.290, "lng": 103.850 },      â”‚
â”‚     "startTime": "2025-11-14T09:00:00+08:00",               â”‚
â”‚     "timeBudgetMinutes": 480,                                â”‚
â”‚     "travelTypes": ["PUBLIC_TRANSPORT", "WALKING"],          â”‚
â”‚     "budget": 50                                              â”‚
â”‚   },                                                          â”‚
â”‚   "options": {                                                â”‚
â”‚     "includeRealtimeTransit": true,                          â”‚
â”‚     "algorithm": "auto"                                       â”‚
â”‚   }                                                           â”‚
â”‚ }                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  BACKEND PROCESSING                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚ 1. Validate Input (Zod)                                       â”‚
â”‚    âœ“ places.length >= 2                                      â”‚
â”‚    âœ“ lat/lng in valid range                                  â”‚
â”‚    âœ“ travelTypes not empty                                   â”‚
â”‚                                                               â”‚
â”‚ 2. Build Distance Matrix                                      â”‚
â”‚    For each pair (i, j):                                      â”‚
â”‚      distance[i][j] = OSRM_API() || Haversine()             â”‚
â”‚                                                               â”‚
â”‚ 3. Run TSP                                                    â”‚
â”‚    route = NearestNeighbor(matrix)                           â”‚
â”‚    route = TwoOpt(route, matrix)                             â”‚
â”‚                                                               â”‚
â”‚ 4. Apply Constraints                                          â”‚
â”‚    Filter by timeBudgetMinutes                               â”‚
â”‚                                                               â”‚
â”‚ 5. Calculate Totals                                           â”‚
â”‚    totalDistance = sum(distances)                            â”‚
â”‚    totalDuration = sum(durations + visitTimes)               â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    RESPONSE PAYLOAD                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ {                                                             â”‚
â”‚   "success": true,                                            â”‚
â”‚   "jobId": "job-abc123-def456",                              â”‚
â”‚   "optimizedOrder": [                                         â”‚
â”‚     { "placeId": "p1", "seq": 1 },                           â”‚
â”‚     { "placeId": "p3", "seq": 2 },                           â”‚
â”‚     { "placeId": "p2", "seq": 3 }                            â”‚
â”‚   ],                                                          â”‚
â”‚   "estimatedDurationMinutes": 250,                           â”‚
â”‚   "totalDistanceMeters": 4520,                               â”‚
â”‚   "notes": "Transport options needed for exact timings.",    â”‚
â”‚   "processingTime": "1247ms"                                 â”‚
â”‚ }                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ State Management (Frontend)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            VirtualizedAttractionFeed                         â”‚
â”‚                                                              â”‚
â”‚  [selectedAttractions]  Set<string>                         â”‚
â”‚         â”‚                                                    â”‚
â”‚         â”œâ”€ Add/Remove on checkbox click                     â”‚
â”‚         â””â”€ Triggers FAB visibility                          â”‚
â”‚                                                              â”‚
â”‚  [isModalOpen]  boolean                                     â”‚
â”‚         â”‚                                                    â”‚
â”‚         â”œâ”€ true: FAB clicked                                â”‚
â”‚         â””â”€ false: Modal closed or success                   â”‚
â”‚                                                              â”‚
â”‚  useOptimizeRouteMutation()                                 â”‚
â”‚         â”‚                                                    â”‚
â”‚         â”œâ”€ [isPending]  Loading state                       â”‚
â”‚         â”œâ”€ [error]      Error state                         â”‚
â”‚         â””â”€ [data]       Response data                       â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

State Transitions:

1. selectedAttractions.size = 0
   â†’ FAB hidden

2. User selects attraction
   â†’ selectedAttractions.size++
   â†’ FAB visible

3. User clicks FAB
   â†’ isModalOpen = true

4. User clicks Optimize
   â†’ isPending = true
   â†’ API call starts

5. API success
   â†’ isPending = false
   â†’ data = response
   â†’ isModalOpen = false
   â†’ Show success alert

6. API error
   â†’ isPending = false
   â†’ error = error message
   â†’ Show error alert
```

---

## ğŸ”„ Component Hierarchy

```
App
 â””â”€ BrowserRouter
     â””â”€ Routes
         â””â”€ DiscoveryPage
             â””â”€ VirtualizedAttractionFeed
                 â”œâ”€ ResultCard (multiple)
                 â”‚   â””â”€ Checkbox pill (select/deselect)
                 â”‚
                 â”œâ”€ SelectionFAB
                 â”‚   â”œâ”€ Count badge
                 â”‚   â””â”€ onClick â†’ open modal
                 â”‚
                 â””â”€ OptimizeModal
                     â”œâ”€ Travel type chips
                     â”œâ”€ Budget input
                     â”œâ”€ Options toggles
                     â””â”€ Optimize button
                         â””â”€ onClick â†’ handleOptimizeSubmit()
```

---

## ğŸ—ï¸ Backend Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    API GATEWAY                              â”‚
â”‚                   (Port 4000)                               â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Middleware Stack                                      â”‚ â”‚
â”‚  â”‚  â”œâ”€ Helmet (security)                                 â”‚ â”‚
â”‚  â”‚  â”œâ”€ CORS                                              â”‚ â”‚
â”‚  â”‚  â”œâ”€ Morgan (logging)                                  â”‚ â”‚
â”‚  â”‚  â”œâ”€ Rate Limiter                                      â”‚ â”‚
â”‚  â”‚  â””â”€ Optional Auth                                     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Routes                                                â”‚ â”‚
â”‚  â”‚  â”œâ”€ /api/auth â†’ Auth Service (4001)                  â”‚ â”‚
â”‚  â”‚  â”œâ”€ /api/blog â†’ Blog Service (4003)                  â”‚ â”‚
â”‚  â”‚  â”œâ”€ /api/admin â†’ Admin Service (4002)                â”‚ â”‚
â”‚  â”‚  â””â”€ /api/v1/optimize-route â†’ Route Optimizer (4010)  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â”‚ Proxy
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ROUTE OPTIMIZER SERVICE                        â”‚
â”‚                   (Port 4010)                               â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Fastify Server                                        â”‚ â”‚
â”‚  â”‚  â”œâ”€ POST /api/optimize-route                         â”‚ â”‚
â”‚  â”‚  â”œâ”€ GET  /api/health                                  â”‚ â”‚
â”‚  â”‚  â””â”€ GET  /api/algorithms                              â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Handlers                                              â”‚ â”‚
â”‚  â”‚  â””â”€ optimize-route.handler.ts                        â”‚ â”‚
â”‚  â”‚      â”œâ”€ Zod validation                                â”‚ â”‚
â”‚  â”‚      â”œâ”€ Error handling                                â”‚ â”‚
â”‚  â”‚      â””â”€ Service orchestration                         â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Services                                              â”‚ â”‚
â”‚  â”‚  â””â”€ route-optimizer-v2.service.ts                    â”‚ â”‚
â”‚  â”‚      â”œâ”€ buildDistanceMatrix()                         â”‚ â”‚
â”‚  â”‚      â”œâ”€ runTSP()                                      â”‚ â”‚
â”‚  â”‚      â”‚   â”œâ”€ nearestNeighbor()                        â”‚ â”‚
â”‚  â”‚      â”‚   â””â”€ twoOpt()                                  â”‚ â”‚
â”‚  â”‚      â”œâ”€ applyConstraints()                           â”‚ â”‚
â”‚  â”‚      â””â”€ calculateTotals()                            â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ External APIs                                         â”‚ â”‚
â”‚  â”‚  â”œâ”€ OSRM (routing)                                    â”‚ â”‚
â”‚  â”‚  â””â”€ Google Maps (fallback)                           â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š Performance Flow

```
User clicks "Optimize Route"
          â”‚
          â”œâ”€ 0ms: Request sent
          â”‚
          â”œâ”€ 50ms: API Gateway receives
          â”‚
          â”œâ”€ 60ms: Route Optimizer receives
          â”‚
          â”œâ”€ 70ms: Validation complete
          â”‚
          â”œâ”€ 80-400ms: Distance matrix built
          â”‚   â”‚
          â”‚   â”œâ”€ OSRM API calls (parallel)
          â”‚   â””â”€ Haversine fallback (if needed)
          â”‚
          â”œâ”€ 400-600ms: TSP optimization
          â”‚   â”‚
          â”‚   â”œâ”€ Nearest Neighbor: ~50ms
          â”‚   â””â”€ 2-opt: ~150ms
          â”‚
          â”œâ”€ 600-650ms: Constraints applied
          â”‚
          â”œâ”€ 650-700ms: Totals calculated
          â”‚
          â”œâ”€ 700-750ms: Response sent
          â”‚
          â””â”€ 800ms: Frontend receives
              â”‚
              â””â”€ User sees result

Total: ~800ms for 3-4 places âœ…
```

---

## ğŸ¯ Success Visualization

```
Before:
â”Œâ”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”
â”‚  A  â”‚â”€â”€â”€â”€â–¶â”‚  B  â”‚â”€â”€â”€â”€â–¶â”‚  C  â”‚
â””â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”˜
 1.2km       1.8km
         Total: 3.0km

After Optimization:
â”Œâ”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”
â”‚  A  â”‚â”€â”€â”€â”€â–¶â”‚  C  â”‚â”€â”€â”€â”€â–¶â”‚  B  â”‚
â””â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”˜
 2.4km       1.8km
         Total: 4.2km

Wait... that's worse! âŒ

Actually optimized:
â”Œâ”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”
â”‚  C  â”‚â”€â”€â”€â”€â–¶â”‚  B  â”‚â”€â”€â”€â”€â–¶â”‚  A  â”‚
â””â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”˜
 1.8km       1.2km
         Total: 3.0km âœ…

(Different starting point changes the route!)
```

---

This visual guide shows the complete flow from UI interaction to backend optimization! ğŸ¨
